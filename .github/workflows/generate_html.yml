name: Generate HTML and Create New Branch to update page

permissions:
  contents: write
  pull-requests: write

on:
  push:
    paths:
      - '**/*.py'
      - '**/*.toml'

jobs:
  generate_html:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Poetry
        run: |
          curl -sSL https://install.python-poetry.org | python3 -

      - name: Add Poetry to PATH
        run: echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Install dependencies with Poetry
        run: poetry install

      - name: Run generater.py to generate index.html
        run: poetry run python generater.py

      - name: Commit and push to new branch
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "Generate new index.html"
          branch: generate-index-html
          delete-branch: true
          title: "Auto-generated index.html"
          body: "This PR contains the updated index.html generated by generater.py."
          add-paths: index.html